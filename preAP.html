<html>
<head>
	<style>
	*{padding: 0; margin:0;}
	canvas{ background: #eee; display: block; margin: 0 auto;}
	</style>
</head>

<body>
<canvas id= "myCanvas" width="800" height="600"></canvas>
<script type="text/javascript">
var canvas = document.getElementById("myCanvas");
var ctx = canvas.getContext("2d");

var blockX = 1;
var blockY = 1;
var blockWidth = 50;
var blockHeight = 30;
var blockXSpeed = 2;
var blockYSpeed = 2;
var color = "rgb(0, 255, 0)";
var blocks = [];
var brokenBlocks = [];
var numBlocks = 100;
var pX = 400;
var pY = 300;
var pXspeed = 1;
var pYspeed = 1;


function Block(x1, y1, w1, h1, xS1, yS1, r1, g1, b1, numHits1)
{
	this.x = x1;
	this.y = y1;
	this.w = w1;
	this.h = h1;
	this.xS = xS1;
	this.yS = yS1;
	this.r = r1;
	this.g = g1;
	this.b = b1;
	this.numHits = numHits1;
}

function BrokenBlock(xx1, yy1, xx2, yy2, xx3, yy3, xx4, yy4, w1, h1, r1, g1, b1)
{
	this.x1 = xx1;
	this.y1 = yy1;
	this.x2 = xx2;
	this.y2 = yy2;
	this.x3 = xx3;
	this.y3 = yy3;
	this.x4 = xx4;
	this.y4 = yy4;
	this.w = w1;
	this.h = h1;
	this.r = r1;
	this.g = g1;
	this.b = b1;
	this.it = 0;
}

for(var i = 0; i < numBlocks; i++)
{
	var x = Math.floor(Math.random() * 750) + 25;
	var y = Math.floor(Math.random() * 550) + 25;
	var w = Math.floor(Math.random() * 40) + 5;
	var h = Math.floor(Math.random() * 40) + 5;
	var xS = ((Math.random() * 60)*.1) - 3;
	while(xS == 0)
	{
		xS = ((Math.random() * 60)*.1) - 3;
	}
	var yS = ((Math.random() * 60)*.1) - 3;
	while(yS == 0)
	{
		yS = ((Math.random() * 60)*.1) - 3;
	}
	var r = Math.floor(Math.random() * 256);
	var g = Math.floor(Math.random() * 256);
	var b = Math.floor(Math.random() * 256);
	var numHits = 0;
	blocks[i] = new Block(x,y,w,h,xS,yS,r,g,b,numHits);
}

function drawBlock()
{
	for(var i = 0; i < numBlocks; i++)
	{
		color = "rgb(" + blocks[i].r + ", " + blocks[i].g + ", " + blocks[i].b + ")";
		if(blocks[i].numHits == 0)
		{
		ctx.fillStyle = color;
		ctx.fillRect(blocks[i].x, blocks[i].y, blocks[i].w, blocks[i].h);
		}
		blocks[i].x += blocks[i].xS;
		blocks[i].y += blocks[i].yS;
		if(blocks[i].x <= 0 || blocks[i].x + blocks[i].w >=  800)
		{
			blocks[i].xS  = -1 * blocks[i].xS;
			///blocks[i].xS *= -1;
		}
		if(blocks[i].y <= 0 || blocks[i].y + blocks[i].h >=  600)
		{
			blocks[i].yS  = -1 * blocks[i].yS;
			///blocks[i].yS *= -1;
		}
		if(pX >= blocks[i].x && 
		pX <= blocks[i].x + blocks[i].w &&
		pY >= blocks[i].y &&
		pY <= blocks[i].y + blocks[i].h)
		{
			//a collision has happened
			console.log("A collision has happened.");
			blocks[i].numHits += 1;
			//add broken block
			var x1 = blocks[i].x;
			var y1 = blocks[i].y;
			var x2 = blocks[i].x + (blocks[i].w / 2);
			var y2 = blocks[i].y;
			var x3 = blocks[i].x;
			var y3 = blocks[i].y + (blocks[i].h / 2);
			var x4 = blocks[i].x + (blocks[i].w / 2);
			var y4 = blocks[i].y + (blocks[i].h / 2);
			var w = blocks[i].w / 2;
			var h = blocks[i].h / 2;
			var r = blocks[i].r;
			var g = blocks[i].g;
			var b = blocks[i].b;
			brokenBlocks[brokenBlocks.length] = new BrokenBlock(x1,y1,x2,y2,x3,y3,x4,y4,w,h,r,g,b);
			blocks.slice(i, 1);
			i--;
		}
	}
	
	for(var i = 0; i < brokenBlocks.length; i++)
	{
	//draw block 1
	
	//draw block 2
	
	//draw block 3
	
	//draw block 4
	}
	
	//draw pixel
	ctx.fillStyle = "rgb(255,255,255)";
	ctx.fillRect(pX, pY, 1, 1);
}

function collision()
{
	if(pX <= 0 || pX + 1 >=  800)
	{
		pXspeed *= -1;
	}
	if(pY <= 0 || pY + 1 >=  600)
	{
		pYspeed *= -1;
	}
}

function drawBrokenBlocks()
{
	for(var a = 0; a < brokenBlocks.length; a++)
	{
		ctx.fillStyle = "rgb("+brokenBlocks[a].r+","+brokenBlocks[a].g+","+brokenBlocks[a].b + ")";
		ctx.fillRect(brokenBlocks[a].x1, brokenBlocks[a].y1,brokenBlocks[a].w, brokenBlocks[a].h);
		ctx.fillRect(brokenBlocks[a].x2, brokenBlocks[a].y2,brokenBlocks[a].w, brokenBlocks[a].h);
		ctx.fillRect(brokenBlocks[a].x3, brokenBlocks[a].y3,brokenBlocks[a].w, brokenBlocks[a].h);
		ctx.fillRect(brokenBlocks[a].x4, brokenBlocks[a].y4,brokenBlocks[a].w, brokenBlocks[a].h);
		brokenBlocks[a].x1 -= 1;
		brokenBlocks[a].x2 += 1;
		brokenBlocks[a].x3 -= 1;
		brokenBlocks[a].x4 += 1;
		brokenBlocks[a].y1 -= 1;
		brokenBlocks[a].y2 -= 1;
		brokenBlocks[a].y3 += 1;
		brokenBlocks[a].y4 += 1;
		brokenBlocks[a].it += 1;
		if(brokenBlocks[a].it > 15)
		{
		brokenBlocks.slice(a, 1);
		}
	}
}

function draw()
{
	ctx.clearRect(0,0,800,600);
	ctx.fillStyle = "rgb(0,0,0)"
	ctx.fillRect(0,0,800,600);
	drawBlock();
	collision();
	drawBrokenBlocks();
}

setInterval(draw, 2);

</script>
</body>
</html>
